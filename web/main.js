var pic_w = 2000;
var pic_h = 1150;
var bg_w, bg_h;
var time = 0;
var beep_count = 0;

// t=0 if heat sensor / t=1 if smoke sensor
var coord = {
    f1: [
    {t: 1, x: 6400, y: 19200},
    {t: 0, x: 5100, y: 19200},
    {t: 0, x: 4200, y: 2000},
    {t: 0, x: 4500, y: 6300},
    {t: 0, x: 8800, y: 6300},
    {t: 0, x: 8800, y: 2900},
    {t: 0, x: 4400, y: 10000},
    {t: 0, x: 11000, y: 11000},
    {t: 1, x: 12050, y: 11000},
    {t: 0, x: 20000, y: 11000},
    {t: 0, x: 20000, y: 19000},
    {t: 0, x: 27000, y: 11000},
    {t: 0, x: 27000, y: 19000},
    {t: 1, x: 23500, y: 15500},
    ],

    f2: [
    {t: 0, x: 4700, y: 6300},
    {t: 0, x: 9000, y: 6300},
    {t: 0, x: 4700, y: 16900},
    {t: 0, x: 9000, y: 16900},
    {t: 0, x: 4450, y: 1800},
    {t: 0, x: 9500, y: 2900},
    {t: 0, x: 4700, y: 9900},
    {t: 0, x: 4700, y: 12900},
    {t: 0, x: 4700, y: 21000},
    {t: 0, x: 9200, y: 20000},
    {t: 0, x: 11800, y: 11000},
    {t: 1, x: 13000, y: 11000},
    {t: 0, x: 15500, y: 9000},
    {t: 0, x: 19400, y: 9000},
    {t: 0, x: 19400, y: 14000},
    {t: 0, x: 22500, y: 14000},
    {t: 0, x: 23000, y: 9000},
    ],

    f3: [
    {t: 0, x: 4200, y: 6300},
    {t: 0, x: 8500, y: 6300},
    {t: 0, x: 4200, y: 16900},
    {t: 0, x: 8500, y: 16900},
    {t: 0, x: 4450, y: 1800},
    {t: 0, x: 9000, y: 2900},
    {t: 0, x: 4200, y: 9900},
    {t: 0, x: 4200, y: 12900},
    {t: 0, x: 4200, y: 21000},
    {t: 0, x: 8700, y: 20000},
    {t: 0, x: 10500, y: 11000},
    {t: 1, x: 11500, y: 11000},
    {t: 0, x: 14000, y: 9000},
    {t: 0, x: 17500, y: 9000},
    {t: 0, x: 17500, y: 14000},
    {t: 0, x: 20500, y: 14000},
    {t: 0, x: 21000, y: 9000},
    ]
};

var frame = {
    f1: [
[   0,    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,0],
[   0,    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,0],
[   0,    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,0],
[   0,    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,0],
[   0,    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,0],
[   0,    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,0],
[   0,    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,0],
[   0,    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,0],
[   0,    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,0],
[   0,    0,    1,    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,0],
[   0,    0,    2,    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,0],
[   0,    0,    4,    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,0],
[   0,    0,    6,    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,0],
[   0,    0,    8,    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,0],
[   0,    0,   10,    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,0],
[   0,    0,   12,    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,0],
[   0,    0,   14,    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,0],
[   0,    0,   16,    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,0],
[   0,    0,   18,    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,0],
[   0,    0,   20,    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,0],
[   0,    0,   22,    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,0],
[   0,    0,   24,    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,0],
[   0,    0,   26,    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,0],
[   0,    0,   28,    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,0],
[   0,    0,   30,    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,0],
[   0,    0,   32,    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,0],
[   0,    0,   34,    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,0],
[   0,    0,   36,    1,    0,    0,    0,    0,    0,    0,    0,    0,    0,0],
[   0,    0,   38,    2,    0,    0,    0,    0,    0,    0,    0,    0,    0,0],
[   0,    0,   40,    4,    0,    0,    0,    0,    0,    0,    0,    0,    0,0],
[   0,    0,   42,    6,    0,    0,    0,    0,    0,    0,    0,    0,    0,0],
[   0,    0,   44,    8,    0,    2,    0,    0,    0,    0,    0,    0,    0,0],
[   0,    0,   46,   10,    0,    4,    0,    0,    0,    0,    0,    0,    0,0],
[   0,    0,   48,   12,    0,    7,    0,    0,    0,    0,    0,    0,    0,0],
[   0,    0,   50,   14,    0,   10,    0,    0,    0,    0,    0,    0,    0,0],
[   0,    0,   52,   16,    0,   13,    0,    0,    0,    0,    0,    0,    0,0],
[   0,    0,   54,   18,    0,   16,    0,    0,    0,    0,    0,    0,    0,0],
[   0,    0,   56,   20,    0,   19,    0,    0,    0,    0,    0,    0,    0,0],
[   0,    0,   58,   22,    0,   22,    0,    0,    0,    0,    0,    0,    0,0],
[   0,    0,   60,   24,    0,   25,    0,    0,    0,    0,    0,    0,    0,0],
[   0,    0,   62,   26,    0,   28,    0,    0,    0,    0,    0,    0,    0,0],
//* XXX
[   0,    0,   64,   28,    0,   31,    1,    0,    0,    0,    0,    0,    0,0],
[   0,    0,   66,   30,    0,   34,    2,    0,    0,    0,    0,    0,    0,0],
[   0,    0,   68,   32,    1,   37,    4,    0,    0,    0,    0,    0,    0,0],
[   0,    0,   70,   34,    2,   40,    6,    0,    0,    0,    0,    0,    0,0],
[   0,    0,   72,   36,    5,   43,    8,    0,    0,    0,    0,    0,    0,0],
[   0,    0,   74,   38,    8,   46,   10,    0,    0,    0,    0,    0,    0,0],
[   0,    0,   76,   40,   12,   49,   12,    0,    0,    0,    0,    0,    0,0],
[   0,    0,   78,   42,   16,   52,   14,    0,    0,    0,    0,    0,    0,0],
[   0,    0,   80,   44,   20,   55,   16,    0,    0,    0,    0,    0,    0,0],
[   0,    0,   82,   46,   24,   58,   18,    0,    0,    0,    0,    0,    0,0],
[   0,    0,   84,   48,   28,   61,   20,    0,    0,    0,    0,    0,    0,0],
[   0,    0,   86,   50,   32,   64,   22,    0,    0,    0,    0,    0,    0,0],
[   0,    0,   88,   52,   36,   67,   24,    0,    0,    0,    0,    0,    0,0],
[   0,    0,   90,   54,   40,   70,   26,    0,    0,    0,    0,    0,    0,0],
[   0,    0,   92,   56,   44,   73,   28,    0,    0,    0,    0,    0,    0,0],
[   0,    0,   94,   58,   48,   76,   30,    0,    0,    0,    0,    0,    0,0],
[   0,    0,   96,   60,   52,   79,   32,    0,    0,    0,    0,    0,    0,0],
[   0,    0,   98,   62,   56,   82,   34,    0,    0,    0,    0,    0,    0,0],
[   0,    0,  100,   64,   60,   85,   36,    0,    0,    0,    0,    0,    0,0],
[   0,    0,  102,   66,   64,   88,   38,    0,    0,    0,    0,    0,    0,0],
[   0,    0,  104,   68,   68,   91,   40,    0,    0,    0,    0,    0,    0,0],
[   0,    0,  106,   70,   72,   94,   42,    0,    0,    0,    0,    0,    0,0],
[   0,    0,  108,   72,   76,   97,   44,    0,    0,    0,    0,    0,    0,0],
[   0,    0,  110,   74,   80,  100,   46,    0,    0,    0,    0,    0,    0,0],
[   0,    0,  112,   76,   84,  103,   48,    0,    0,    0,    0,    0,    0,0],
[   0,    0,  114,   78,   88,  106,   50,    0,    0,    0,    0,    0,    0,0],
[   0,    0,  116,   80,   92,  109,   52,    0,    0,    0,    0,    0,    0,0],
[   0,    0,  118,   82,   96,  112,   54,    0,    0,    0,    0,    0,    0,0],
[   0,    0,  120,   84,  100,  115,   56,    0,    0,    0,    0,    0,    0,0],
[   0,    0,  122,   86,  104,  118,   58,    0,    0,    0,    0,    0,    0,0],
[   0,    0,  124,   88,  108,  121,   60,    0,    0,    0,    0,    0,    0,0],
[   0,    0,  126,   90,  112,  124,   62,    0,    0,    0,    0,    0,    0,0],
[   0,    0,  128,   92,  116,  127,   64,    1,    0,    0,    0,    0,    0,0],
[   0,    0,  130,   94,  120,  130,   66,    2,    0,    0,    0,    0,    0,0],
[   0,    0,  132,   96,  124,  133,   68,    3,    0,    0,    0,    0,    0,0],
[   0,    0,  134,   98,  128,  136,   70,    4,    0,    0,    0,    0,    0,0],
[   0,    0,  136,  100,  132,  139,   72,    5,    1,    0,    0,    0,    0,0],
[   0,    0,  138,  102,  136,  142,   74,    6,    2,    0,    0,    0,    0,0],
[   0,    0,  140,  104,  140,  145,   76,    7,    4,    0,    0,    0,    0,0],
[   0,    0,  142,  106,  144,  148,   78,    8,    6,    0,    0,    0,    0,0],
[   0,    1,  144,  108,  148,  151,   80,    9,    8,    0,    0,    0,    0,0],
[   0,    2,  146,  110,  152,  154,   82,   10,   10,    0,    0,    0,    0,0],
[   0,    5,  148,  112,  156,  157,   84,   11,   12,    0,    0,    0,    0,0],
[   0,    8,  150,  114,  160,  160,   86,   12,   14,    0,    0,    0,    0,0],
[   1,   11,  152,  116,  164,  163,   88,   13,   16,    0,    0,    0,    0,0],
[   2,   14,  154,  118,  168,  166,   90,   14,   18,    0,    0,    0,    0,0],
[   4,   17,  156,  120,  172,  169,   92,   15,   20,    0,    0,    0,    0,0],
[   6,   20,  158,  122,  176,  172,   94,   16,   22,    0,    0,    0,    0,0],
[   9,   23,  160,  124,  180,  175,   96,   17,   24,    0,    0,    0,    0,0],
[  12,   26,  162,  126,  184,  178,   98,   18,   26,    0,    0,    0,    0,0],
[  15,   29,  164,  128,  188,  181,  100,   19,   28,    0,    0,    0,    0,0],
[  18,   32,  166,  130,  192,  184,  102,   20,   30,    0,    0,    0,    0,0],
[  21,   35,  168,  132,  196,  187,  104,   21,   32,    0,    0,    0,    0,0],
[  24,   38,  170,  134,  200,  190,  106,   22,   34,    0,    0,    0,    0,0],
[  27,   41,  172,  136,  204,  193,  108,   23,   36,    0,    0,    0,    0,0],
[  30,   44,  174,  138,  208,  196,  110,   24,   38,    0,    0,    0,    0,0],
[  33,   47,  176,  140,  212,  199,  112,   25,   40,    0,    0,    0,    0,0],
[  36,   50,  178,  142,  216,  202,  114,   26,   42,    0,    0,    0,    0,0],
[  39,   53,  180,  144,  220,  205,  116,   27,   44,    0,    0,    0,    0,0],
[  42,   56,  182,  146,  224,  208,  118,   28,   46,    0,    0,    0,    0,0],
[  45,   59,  184,  148,  228,  211,  120,   29,   48,    0,    0,    0,    0,0],
[  48,   62,  186,  150,  232,  214,  122,   30,   50,    0,    0,    0,    0,0],
[  51,   65,  188,  152,  236,  217,  124,   31,   52,    0,    0,    0,    0,0],
[  54,   68,  190,  154,  240,  220,  126,   32,   54,    0,    0,    0,    0,0],
[  57,   71,  192,  156,  244,  223,  128,   33,   56,    0,    0,    0,    0,0],
[  60,   74,  194,  158,  248,  226,  130,   34,   58,    0,    0,    0,    0,0],
[  63,   77,  196,  160,  252,  229,  132,   35,   60,    0,    0,    0,    0,0],
[  66,   80,  198,  162,  256,  232,  134,   36,   62,    0,    0,    0,    0,0],
[  69,   83,  200,  164,  260,  235,  136,   37,   64,    1,    0,    0,    0,0],
[  72,   86,  202,  166,  264,  238,  138,   38,   66,    2,    0,    0,    0,0],
[  75,   89,  204,  168,  268,  241,  140,   39,   68,    3,    0,    0,    0,0],
[  78,   92,  206,  170,  272,  244,  142,   40,   70,    4,    0,    0,    0,0],
[  81,   95,  208,  172,  276,  247,  144,   41,   72,    5,    0,    0,    0,0],
[  84,   98,  210,  174,  280,  250,  146,   42,   74,    6,    0,    0,    0,0],
[  87,  101,  212,  176,  284,  253,  148,   43,   76,    7,    0,    0,    0,0],
[  90,  104,  214,  178,  288,  256,  150,   44,   78,    8,    0,    0,    0,0],
[  93,  107,  216,  180,  292,  259,  152,   45,   80,    9,    0,    0,    0,0],
[  96,  110,  218,  182,  296,  262,  154,   46,   82,   10,    0,    0,    0,0],
[  99,  113,  220,  184,  300,  265,  156,   47,   84,   11,    0,    0,    0,0],
[ 102,  116,  222,  186,  304,  268,  158,   48,   86,   12,    0,    0,    0,0],
[ 105,  119,  224,  188,  308,  271,  160,   49,   88,   13,    0,    0,    0,0],
[ 108,  122,  226,  190,  312,  274,  162,   50,   90,   14,    0,    0,    0,0],
[ 111,  125,  228,  192,  316,  277,  164,   51,   92,   15,    0,    0,    0,0],
[ 114,  128,  230,  194,  320,  280,  166,   52,   94,   16,    0,    0,    0,0],
[ 117,  131,  232,  196,  324,  283,  168,   53,   96,   17,    0,    0,    0,0],
[ 120,  134,  234,  198,  328,  286,  170,   54,   98,   18,    0,    0,    0,0],
[ 123,  137,  236,  200,  332,  289,  172,   55,  100,   19,    0,    0,    0,0],
[ 126,  140,  238,  202,  336,  292,  174,   56,  102,   20,    0,    0,    0,0],
[ 129,  143,  240,  204,  340,  295,  176,   57,  104,   21,    0,    0,    0,0],
[ 132,  146,  242,  206,  344,  298,  178,   58,  106,   22,    0,    0,    0,0],
[ 135,  149,  244,  208,  348,  301,  180,   59,  108,   23,    0,    0,    0,0],
[ 138,  152,  246,  210,  352,  304,  182,   60,  110,   24,    0,    0,    0,0],
[ 141,  155,  248,  212,  356,  307,  184,   61,  112,   25,    0,    0,    0,0],
[ 144,  158,  250,  214,  360,  310,  186,   62,  114,   26,    0,    0,    0,0],
[ 147,  161,  252,  216,  364,  313,  188,   63,  116,   27,    0,    0,    0,0],
[ 150,  164,  254,  218,  368,  316,  190,   64,  118,   28,    0,    0,    0,0],
[ 153,  167,  256,  220,  372,  319,  192,   65,  120,   29,    0,    1,    0,0],
[ 156,  170,  258,  222,  376,  322,  194,   66,  122,   30,    0,    2,    0,0],
[ 159,  173,  260,  224,  380,  325,  196,   67,  124,   31,    0,    3,    0,0],
[ 162,  176,  262,  226,  384,  328,  198,   68,  126,   32,    0,    4,    0,0],
[ 165,  179,  264,  228,  388,  331,  200,   69,  128,   33,    1,    5,    0,0],
[ 168,  182,  266,  230,  392,  334,  202,   70,  130,   34,    2,    6,    0,0],
[ 171,  185,  268,  232,  396,  337,  204,   71,  132,   35,    3,    7,    0,0],
[ 174,  188,  270,  234,  400,  340,  206,   72,  134,   36,    4,    8,    0,0],
[ 177,  191,  272,  236,  404,  343,  208,   73,  136,   37,    5,    9,    0,0],
[ 180,  194,  274,  238,  408,  346,  210,   74,  138,   38,    6,   10,    0,0],
[ 183,  197,  276,  240,  412,  349,  212,   75,  140,   39,    7,   11,    0,0],
[ 186,  200,  278,  242,  416,  352,  214,   76,  142,   40,    8,   12,    0,0],
[ 189,  203,  280,  244,  420,  355,  216,   77,  144,   41,    9,   13,    0,0],
[ 192,  206,  282,  246,  424,  358,  218,   78,  146,   42,   10,   14,    0,0],
[ 195,  209,  284,  248,  428,  361,  220,   79,  148,   43,   11,   15,    0,0],
[ 198,  212,  286,  250,  432,  364,  222,   80,  150,   44,   12,   16,    0,0],
[ 201,  215,  288,  252,  436,  367,  224,   81,  152,   45,   13,   17,    0,0],
[ 204,  218,  290,  254,  440,  370,  226,   82,  154,   46,   14,   18,    0,0],
[ 207,  221,  292,  256,  444,  373,  228,   83,  156,   47,   15,   19,    0,0],
[ 210,  224,  294,  258,  448,  376,  230,   84,  158,   48,   16,   20,    0,0],
[ 213,  227,  296,  260,  452,  379,  232,   85,  160,   49,   17,   21,    0,0],
[ 216,  230,  298,  262,  456,  382,  234,   86,  162,   50,   18,   22,    0,0],
[ 219,  233,  300,  264,  460,  385,  236,   87,  164,   51,   19,   23,    0,0],
[ 222,  236,  302,  266,  464,  388,  238,   88,  166,   52,   20,   24,    0,0],
[ 225,  239,  304,  268,  468,  391,  240,   89,  168,   53,   21,   25,    0,0],
[ 228,  242,  306,  270,  472,  394,  242,   90,  170,   54,   22,   26,    0,0],
[ 231,  245,  308,  272,  476,  397,  244,   91,  172,   55,   23,   27,    0,0],
[ 234,  248,  310,  274,  480,  400,  246,   92,  174,   56,   24,   28,    0,0],
[ 237,  251,  312,  276,  484,  403,  248,   93,  176,   57,   25,   29,    0,0],
[ 240,  254,  314,  278,  488,  406,  250,   94,  178,   58,   26,   30,    0,0],
[ 243,  257,  316,  280,  492,  409,  252,   95,  180,   59,   27,   31,    0,0],
[ 246,  260,  318,  282,  496,  412,  254,   96,  182,   60,   28,   32,    0,0],
[ 249,  263,  320,  284,  500,  415,  256,   97,  184,   61,   29,   33,    1,0],
[ 252,  266,  322,  286,  504,  418,  258,   98,  186,   62,   30,   34,    2,0],
[ 255,  269,  324,  288,  508,  421,  260,   99,  188,   63,   31,   35,    3,0],
[ 258,  272,  326,  290,  512,  424,  262,  100,  190,   64,   32,   36,    4,0],
[ 261,  275,  328,  292,  516,  427,  264,  101,  192,   65,   33,   37,    5,0],
[ 264,  278,  330,  294,  520,  430,  266,  102,  194,   66,   34,   38,    6,0],
[ 267,  281,  332,  296,  524,  433,  268,  103,  196,   67,   35,   39,    7,0],
[ 270,  284,  334,  298,  528,  436,  270,  104,  198,   68,   36,   40,    8,0],
[ 273,  287,  336,  300,  532,  439,  272,  105,  200,   69,   37,   41,    9,0],
[ 276,  290,  338,  302,  536,  442,  274,  106,  202,   70,   38,   42,   10,0],
[ 279,  293,  340,  304,  540,  445,  276,  107,  204,   71,   39,   43,   11,0],
[ 282,  296,  342,  306,  544,  448,  278,  108,  206,   72,   40,   44,   12,0],
[ 285,  299,  344,  308,  548,  451,  280,  109,  208,   73,   41,   45,   13,0],
[ 288,  302,  346,  310,  552,  454,  282,  110,  210,   74,   42,   46,   14,0],
[ 291,  305,  348,  312,  556,  457,  284,  111,  212,   75,   43,   47,   15,0],
[ 294,  308,  350,  314,  560,  460,  286,  112,  214,   76,   44,   48,   16,0],
[ 297,  311,  352,  316,  564,  463,  288,  113,  216,   77,   45,   49,   17,0],
[ 300,  314,  354,  318,  568,  466,  290,  114,  218,   78,   46,   50,   18,0],
[ 303,  317,  356,  320,  572,  469,  292,  115,  220,   79,   47,   51,   19,0],
[ 306,  320,  358,  322,  576,  472,  294,  116,  222,   80,   48,   52,   20,0],
[ 309,  323,  360,  324,  580,  475,  296,  117,  224,   81,   49,   53,   21,0],
[ 312,  326,  362,  326,  584,  478,  298,  118,  226,   82,   50,   54,   22,0],
[ 315,  329,  364,  328,  588,  481,  300,  119,  228,   83,   51,   55,   23,0],
[ 318,  332,  366,  330,  592,  484,  302,  120,  230,   84,   52,   56,   24,0],
[ 321,  335,  368,  332,  596,  487,  304,  121,  232,   85,   53,   57,   25,0],
[ 324,  338,  370,  334,  600,  490,  306,  122,  234,   86,   54,   58,   26,0],
[ 327,  341,  372,  336,  604,  493,  308,  123,  236,   87,   55,   59,   27,0],
[ 330,  344,  374,  338,  608,  496,  310,  124,  238,   88,   56,   60,   28,0],
[ 333,  347,  376,  340,  612,  499,  312,  125,  240,   89,   57,   61,   29,0],
[ 336,  350,  378,  342,  616,  502,  314,  126,  242,   90,   58,   62,   30,0],
[ 339,  353,  380,  344,  620,  505,  316,  127,  244,   91,   59,   63,   31,0],
[ 342,  356,  382,  346,  624,  508,  318,  128,  246,   92,   60,   64,   32,0],
[ 345,  359,  384,  348,  628,  511,  320,  129,  248,   93,   61,   65,   33,0],
[ 348,  362,  386,  350,  632,  514,  322,  130,  250,   94,   62,   66,   34,0],
[ 351,  365,  388,  352,  636,  517,  324,  131,  252,   95,   63,   67,   35,0],
[ 354,  368,  390,  354,  640,  520,  326,  132,  254,   96,   64,   68,   36,0],
[ 357,  371,  392,  356,  644,  523,  328,  133,  256,   97,   65,   69,   37,0],
[ 360,  374,  394,  358,  648,  526,  330,  134,  258,   98,   66,   70,   38,0],
[ 363,  377,  396,  360,  652,  529,  332,  135,  260,   99,   67,   71,   39,0],
[ 366,  380,  398,  362,  656,  532,  334,  136,  262,  100,   68,   72,   40,0],
[ 369,  383,  400,  364,  660,  535,  336,  137,  264,  101,   69,   73,   41,0],
[ 372,  386,  402,  366,  664,  538,  338,  138,  266,  102,   70,   74,   42,0],
[ 375,  389,  404,  368,  668,  541,  340,  139,  268,  103,   71,   75,   43,0],
[ 378,  392,  406,  370,  672,  544,  342,  140,  270,  104,   72,   76,   44,0],
[ 381,  395,  408,  372,  676,  547,  344,  141,  272,  105,   73,   77,   45,0],
[ 384,  398,  410,  374,  680,  550,  346,  142,  274,  106,   74,   78,   46,0],
[ 387,  401,  412,  376,  684,  553,  348,  143,  276,  107,   75,   79,   47,0],
[ 390,  404,  414,  378,  688,  556,  350,  144,  278,  108,   76,   80,   48,0],
[ 393,  407,  416,  380,  692,  559,  352,  145,  280,  109,   77,   81,   49,0],
[ 396,  410,  418,  382,  696,  562,  354,  146,  282,  110,   78,   82,   50,0],
[ 399,  413,  420,  384,  700,  565,  356,  147,  284,  111,   79,   83,   51,0],
[ 402,  416,  422,  386,  704,  568,  358,  148,  286,  112,   80,   84,   52,0],
[ 405,  419,  424,  388,  708,  571,  360,  149,  288,  113,   81,   85,   53,0],
[ 408,  422,  426,  390,  712,  574,  362,  150,  290,  114,   82,   86,   54,0],
[ 411,  425,  428,  392,  716,  577,  364,  151,  292,  115,   83,   87,   55,0],
[ 414,  428,  430,  394,  720,  580,  366,  152,  294,  116,   84,   88,   56,0],
[ 417,  431,  432,  396,  724,  583,  368,  153,  296,  117,   85,   89,   57,0],
[ 420,  434,  434,  398,  728,  586,  370,  154,  298,  118,   86,   90,   58,0],
[ 423,  437,  436,  400,  732,  589,  372,  155,  300,  119,   87,   91,   59,0],
[ 426,  440,  438,  402,  736,  592,  374,  156,  302,  120,   88,   92,   60,0],
[ 429,  443,  440,  404,  740,  595,  376,  157,  304,  121,   89,   93,   61,0],
[ 432,  446,  442,  406,  744,  598,  378,  158,  306,  122,   90,   94,   62,0],
[ 435,  449,  444,  408,  748,  601,  380,  159,  308,  123,   91,   95,   63,0],
[ 438,  452,  446,  410,  752,  604,  382,  160,  310,  124,   92,   96,   64,0],
[ 441,  455,  448,  412,  756,  607,  384,  161,  312,  125,   93,   97,   65,0],
[ 444,  458,  450,  414,  760,  610,  386,  162,  314,  126,   94,   98,   66,0],
[ 447,  461,  452,  416,  764,  613,  388,  163,  316,  127,   95,   99,   67,0],
[ 450,  464,  454,  418,  768,  616,  390,  164,  318,  128,   96,  100,   68,0],
[ 453,  467,  456,  420,  772,  619,  392,  165,  320,  129,   97,  101,   69,0],
[ 456,  470,  458,  422,  776,  622,  394,  166,  322,  130,   98,  102,   70,0],
[ 459,  473,  460,  424,  780,  625,  396,  167,  324,  131,   99,  103,   71,0],
[ 462,  476,  462,  426,  784,  628,  398,  168,  326,  132,  100,  104,   72,0],
[ 465,  479,  464,  428,  788,  631,  400,  169,  328,  133,  101,  105,   73,0],
[ 468,  482,  466,  430,  792,  634,  402,  170,  330,  134,  102,  106,   74,0],
[ 471,  485,  468,  432,  796,  637,  404,  171,  332,  135,  103,  107,   75,0],
[ 474,  488,  470,  434,  800,  640,  406,  172,  334,  136,  104,  108,   76,0],
[ 477,  491,  472,  436,  804,  643,  408,  173,  336,  137,  105,  109,   77,0],
[ 480,  494,  474,  438,  808,  646,  410,  174,  338,  138,  106,  110,   78,0],
[ 483,  497,  476,  440,  812,  649,  412,  175,  340,  139,  107,  111,   79,0],
[ 486,  500,  478,  442,  816,  652,  414,  176,  342,  140,  108,  112,   80,0],
[ 489,  503,  480,  444,  820,  655,  416,  177,  344,  141,  109,  113,   81,0],
[ 492,  506,  482,  446,  824,  658,  418,  178,  346,  142,  110,  114,   82,0],
[ 495,  509,  484,  448,  828,  661,  420,  179,  348,  143,  111,  115,   83,0],
[ 498,  512,  486,  450,  832,  664,  422,  180,  350,  144,  112,  116,   84,0],
[ 501,  515,  488,  452,  836,  667,  424,  181,  352,  145,  113,  117,   85,0],
[ 504,  518,  490,  454,  840,  670,  426,  182,  354,  146,  114,  118,   86,0],
[ 507,  521,  492,  456,  844,  673,  428,  183,  356,  147,  115,  119,   87,0],
[ 510,  524,  494,  458,  848,  676,  430,  184,  358,  148,  116,  120,   88,0],
[ 513,  527,  496,  460,  852,  679,  432,  185,  360,  149,  117,  121,   89,0],
[ 516,  530,  498,  462,  856,  682,  434,  186,  362,  150,  118,  122,   90,0],
[ 519,  533,  500,  464,  860,  685,  436,  187,  364,  151,  119,  123,   91,0],
[ 522,  536,  502,  466,  864,  688,  438,  188,  366,  152,  120,  124,   92,0],
[ 525,  539,  504,  468,  868,  691,  440,  189,  368,  153,  121,  125,   93,0],
[ 528,  542,  506,  470,  872,  694,  442,  190,  370,  154,  122,  126,   94,0],
[ 531,  545,  508,  472,  876,  697,  444,  191,  372,  155,  123,  127,   95,0],
[ 534,  548,  510,  474,  880,  700,  446,  192,  374,  156,  124,  128,   96,0],
[ 537,  551,  512,  476,  884,  703,  448,  193,  376,  157,  125,  129,   97,0],
[ 540,  554,  514,  478,  888,  706,  450,  194,  378,  158,  126,  130,   98,0],
[ 543,  557,  516,  480,  892,  709,  452,  195,  380,  159,  127,  131,   99,0],
[ 546,  560,  518,  482,  896,  712,  454,  196,  382,  160,  128,  132,  100,0],
[ 549,  563,  520,  484,  900,  715,  456,  197,  384,  161,  129,  133,  101,0],
[ 552,  566,  522,  486,  904,  718,  458,  198,  386,  162,  130,  134,  102,0],
[ 555,  569,  524,  488,  908,  721,  460,  199,  388,  163,  131,  135,  103,0],
[ 558,  572,  526,  490,  912,  724,  462,  200,  390,  164,  132,  136,  104,0],
[ 561,  575,  528,  492,  916,  727,  464,  201,  392,  165,  133,  137,  105,0],
[ 564,  578,  530,  494,  920,  730,  466,  202,  394,  166,  134,  138,  106,0],
[ 567,  581,  532,  496,  924,  733,  468,  203,  396,  167,  135,  139,  107,0],
[ 570,  584,  534,  498,  928,  736,  470,  204,  398,  168,  136,  140,  108,0],
[ 573,  587,  536,  500,  932,  739,  472,  205,  400,  169,  137,  141,  109,0],
[ 576,  590,  538,  502,  936,  742,  474,  206,  402,  170,  138,  142,  110,0],
[ 579,  593,  540,  504,  940,  745,  476,  207,  404,  171,  139,  143,  111,0],
[ 582,  596,  542,  506,  944,  748,  478,  208,  406,  172,  140,  144,  112,0],
[ 585,  599,  544,  508,  948,  751,  480,  209,  408,  173,  141,  145,  113,0],
[ 588,  602,  546,  510,  952,  754,  482,  210,  410,  174,  142,  146,  114,0],
[ 591,  605,  548,  512,  956,  757,  484,  211,  412,  175,  143,  147,  115,0],
[ 594,  608,  550,  514,  960,  760,  486,  212,  414,  176,  144,  148,  116,0],
[ 597,  611,  552,  516,  964,  763,  488,  213,  416,  177,  145,  149,  117,0],
[ 600,  614,  554,  518,  968,  766,  490,  214,  418,  178,  146,  150,  118,0],
[ 603,  617,  556,  520,  972,  769,  492,  215,  420,  179,  147,  151,  119,0],
[ 606,  620,  558,  522,  976,  772,  494,  216,  422,  180,  148,  152,  120,0],
[ 609,  623,  560,  524,  980,  775,  496,  217,  424,  181,  149,  153,  121,0],
[ 612,  626,  562,  526,  984,  778,  498,  218,  426,  182,  150,  154,  122,0],
[ 615,  629,  564,  528,  988,  781,  500,  219,  428,  183,  151,  155,  123,0],
[ 618,  632,  566,  530,  992,  784,  502,  220,  430,  184,  152,  156,  124,0],
[ 621,  635,  568,  532,  996,  787,  504,  221,  432,  185,  153,  157,  125,0],
[ 624,  638,  570,  534, 1000,  790,  506,  222,  434,  186,  154,  158,  126,0],
[ 627,  641,  572,  536, 1004,  793,  508,  223,  436,  187,  155,  159,  127,0],
[ 630,  644,  574,  538, 1008,  796,  510,  224,  438,  188,  156,  160,  128,0],
[ 633,  647,  576,  540, 1012,  799,  512,  225,  440,  189,  157,  161,  129,0],
//*/
    ],
    f2: [
    ],
};

function draw_floor(name, time)
{
    var p = $(".floor." + name);
    var c = coord[name];
    for (var i=0; i<c.length; i++)
    {
        var r = c[i];
        if (name == 'f1') {
            var px = (354 + 0.042 * r.x) * bg_w / 2000;
            var py = (1064 - 0.04 * r.y) * bg_h / 1150;
        }
        else if (name == 'f2') {
            var px = (401.64 + 0.039 * r.x) * bg_w / 2000;
            var py = (1026.786 - 0.04 * r.y) * bg_h / 1150;
        }
        else if (name == 'f3') {
            var px = (473 + 0.043 * r.x) * bg_w / 2000;
            var py = (1032 - 0.0396 * r.y) * bg_h / 1150;
        }
        if (!frame[name][time])
            return;
        if (frame[name][time][i] == 0) continue;
        beep_count += 1;
        if (time > 1 && frame[name][time-1][i] == 0) {
            console.log("new");
            $('.doubleBeep').trigger('play');
        }
        if (r.t)
            var e = $('<img src="yellow.gif"/>');
        else
            var e = $('<img src="red.gif"/>');
        var pr = 200 * bg_w / pic_w;
        e.css('top', py + 'px');
        e.css('left', px + 'px');
        e.css('width', pr + 'px');
        e.css('opacity', Math.min(1, frame[name][time][i] / 1000.0 + 0.3));
        e.addClass("sensor");
        p.append(e);
    }
}

function draw_frame(time)
{
    $(".sensor").remove();
    beep_count = 0;
    draw_floor('f1', time);
//    draw_floor('f2', frame.f2[time]);
//    draw_floor('f3', frame.f2[time]);
}

function scale()
{
    var scr_w = $(window).width();
    var scr_h = $(window).height();
    scr_w = $(".container").width();
    scr_h = $(".container").height();
    var e = $(".floor");

    var w, h;
    if (scr_h * pic_w < scr_w * pic_h) {
        bg_h = scr_h;
        bg_w = scr_h * pic_w / pic_h;
        e.css('left', ((scr_w - bg_w) / 2) + 'px');
        e.css('top', 0);
    }
    else {
        bg_w = scr_w;
        bg_h = scr_w * pic_h / pic_w;
        e.css('top', ((scr_h - bg_h) / 2) + 'px');
        e.css('left', 0);
    }
    e.css('width', bg_w + 'px');
    e.css('height', bg_h + 'px');
}

function resize_all()
{
    scale();
    draw_frame(time);
}

function show_floor()
{
    if (location.hash === "")
        $('#floor').text('3F');
    else
        $('#floor').text(location.hash.slice(1) + 'F');
}

function play()
{
    draw_frame(time);
    if (time < frame.f1.length)
        time++;
    $(".beep").trigger('play');
    var dt = 500 / Math.log(beep_count/1.5 + 2) + 500;
    setTimeout(play, dt);
}

function checkTime(i) {
    if (i < 10) {i = "0" + i};  // add zero in front of numbers < 10
    return i;
}
function clock()
{
    var today = new Date();
    var h = today.getHours();
    var m = today.getMinutes();
    var s = today.getSeconds();
    m = checkTime(m);
    s = checkTime(s);
    $('#time').text(h + ":" + m + ":" + s);
    setTimeout(clock, 500);
}

$(window).resize(resize_all);
$(window).on('hashchange', function() {
    show_floor();
});
$(window).ready(function() {
    resize_all();
    show_floor();
    $('#fullpage').fullpage({
        scrollingSpeed: 400,
        anchors: ['3','2','1'],
        slidesNavigation: true,
        navigation: true,
        navigationPosition: 'left',
    });
    play();
    clock();
});
